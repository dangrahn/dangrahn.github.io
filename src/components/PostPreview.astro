---
import type { CollectionEntry } from 'astro:content'
import { render } from 'astro:content'
import Tags from '~/components/Tags.astro'
import PostInfo from '~/components/PostInfo.astro'
import type { Collation } from '~/types'
import { TagsGroup } from '~/utils'

interface Props {
  post: CollectionEntry<'posts'>
}

const { post } = Astro.props

const { remarkPluginFrontmatter } = await render(post)
const description = remarkPluginFrontmatter.description || post.data.description
let tags: Collation<'posts'>[] | undefined
if (post.data.tags && post.data.tags.length > 0) {
  const tagsGroup = await TagsGroup.build()
  tags = tagsGroup.matchMany(post.data.tags)
}
const samePage = Astro.url.pathname === `/posts/${post.id}`
const articleLink = samePage ? `#${post.id}` : `/posts/${post.id}`
---

<article class="py-6 border-b border-foreground/5 last:border-b-0">
  <h2 class="text-base font-medium text-foreground mb-2">
    <a href={articleLink} class="no-underline hover:text-accent transition-colors duration-150">{post.data.title}</a>
  </h2>
  <PostInfo post={post} class="mb-3 text-foreground/50" />
  {description && <p class="text-sm text-foreground/70 leading-relaxed mb-3">{description}</p>}
  {tags && <Tags tags={tags} />}
</article>
